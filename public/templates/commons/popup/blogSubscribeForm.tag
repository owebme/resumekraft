<blog-subscribe-form>

    <div class="input-group input-group-icon">
        <div onClick={ success } onUpdate="none" class="input-group-addon flex-centered bg-blue borderRadius-m btn-active">
            <svg class="w24 h24" style="margin-top:3px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.99998 639.999975" version="1.1" x="0px" y="0px"><g transform="translate(-91.214475,-152.15558)"><g transform="matrix(0,-1.2428946,1.2437461,0,-150.79005,839.70654)"><rect ry="37.436085" y="250.03104" x="308.55121" height="274.84021" width="74.872169" style="fill:#fff"/><rect ry="37.46793" transform="matrix(0.70650574,0.70770731,-0.70650574,0.70770731,0,0)" y="-159.08594" x="570.86584" height="313.4476" width="74.93586" style="fill:#fff"/><rect ry="37.46793" transform="matrix(0.70650574,-0.70770731,0.70650574,0.70770731,0,0)" y="332.36725" x="-154.34863" height="313.4476" width="74.93586" style="fill:#fff"/></g></g></svg>
        </div>
        <input ref="input" class="input input-m { input-error : error }" type="text" placeholder="E-mail" autocomplete="off">
        <div class="input-icon">
            <svg class="input-svg" viewBox="3 -3 24 24"><path class="{ error ? 'fill-red' : 'input-svg-color' }" d="M15 11.9c-.9 0-1.7-.2-2.3-.7l-5.7-4.4v8.1c0 .1 0 .3.1.4.1.1.2.2.3.2 2.5.4 5 .5 7.5.5s5-.2 7.5-.5c.1 0 .3-.1.4-.2.2-.1.2-.3.2-.4v-8.1l-5.7 4.4c-.6.5-1.4.7-2.3.7zm-1.3-2.3c.3.3.8.4 1.3.4s1-.1 1.3-.4l6.1-4.7c.3-.3.5-.6.6-1v-.8c0-.1 0-.3-.1-.4-.1-.1-.2-.2-.4-.2-2.5-.3-5-.5-7.5-.5s-5 .2-7.5.5c-.1 0-.2.1-.3.2-.2.1-.2.3-.2.4v.9c.1.3.3.6.6 1l6.1 4.6z"></path></svg>
        </div>
    </div>

<script>

    var $ = this;

    $.success = function(){
        if (!_.isEmail($.refs.input.value)){
            $.update({
                error: true
            })
        }
        else {
            var email = $.refs.input.value;
            app.request("addBlogSubscribe", {
                email: email
            })
            .then(function(){
                app.metrika.set("offers.popup.blog.subscribe.success", true);
                app.metrika.set("offers.popup.blog.subscribe.email", email);
                $.trigger("success");
            },
            function(){
                $.trigger("fail");
            })
        }
    };

</script>

</blog-subscribe-form>
