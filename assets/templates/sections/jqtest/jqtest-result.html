<jqtest-result class="oScreen" data-open={ active } data-loader={ loading } data-show="down">

    <div class="oScreen__buttons" data-pos="top-right">
        <div onClick={ hide } onUpdate="none" class="button__close" data-color="gray"></div>
    </div>

    <jqtest-result-link if={ !app.device.isPhone }></jqtest-result-link>

    <div ref="scroll" name="scroll" class="oScreen__content { app.device.isPhone ? 'notAnim-scroll' : 'bg-white' }">

        <oScreen-loader></oScreen-loader>

        <div ref="content" name="content" class="screens screens-phone"></div>

    </div>

<script>

    var $ = this,
    $scope = $$($.root);

    $.active = false;

    $.loading = false;

    $.scroll = $$($["scroll"]);

    $.on("mount", function(){
        $Sections.module("jqtest.result", $);
        if ($.refs){
            $.scroll = $$($.refs.scroll);
            $.content = $$($.refs.content);
        }
        $.loader = $.tags["oscreen-loader"];
        // $afterlag.run(function(){
        //     $.show();
        // });
    });

    $.show = function(callback){
        if ($.loading || $.active) return;

        $jqResult = $store.jqtest.jq1;

        $.buttonLink = $.tags["jqtest-result-link"];

        $.loader.show(
            {
                scope: $.scroll,
                content: $.content,
                start: function(){
                    if (app.device.isPhone){
                        $.content.style.backgroundColor = '#ffffff';
                    }
                },
                tag: function(){
                    return $.section = riot.mount($.content, "jqtest-result-content", {
                        scope: $scope,
                        scroll: $.scroll,
                        content: $.content
                    })[0];
                },
                mount: function(){
                    if (app.device.isPhone){
                        $.content.style.backgroundColor = '';
                        $afterlag.run(function() {
                            $.screens = new app.plugins.screens($["content"]);
                            $.screens.init();
                        });
                    }
                    else {
                        $.buttonLink.show();
                        $afterlag.run(function(){
                            $scope.find(".chart").addClass("showChart");
                            $.section.scrollAnimate.start();
                        });
                    }
                    if (_.isFunction(callback)){
                        callback();
                    }
                    if (window.$root && window.$root.focus) $root.focus("jqtest-result");
                }
            }
        );
    };

    $.hide = function(){
        if ($.section && $.section.sections && $.section.sections.specialties && $.section.sections.specialties.active){
            $.section.sections.specialties.hide();
        }
        else {
            $.update({
                active: false
            })
            _.onEndTransition($.scroll[0], function(){
                $.section.unmount(true);
                if (window.$root && window.$root.focus) $root.focus("all");
            });
            $.buttonLink.hide();
        }
    };

    $.get = {
        text: function(tag, text){
            tag.root.innerHTML = text.replace(/\[b\]/, '<span class="larger">').replace(/\[\/b\]/, '</span>').replace(/\[i\]/, '<span class="marker">').replace(/\[\/i\]/, '</span>');
        }
    };

</script>

</jqtest-result>
