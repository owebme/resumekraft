<resume-sendmail class="oScreen zIndex-3 c-white" data-show="modal" data-color="blue" data-open={ active } style="display:none">

    <div onClick={ hide } onUpdate="none">
        <div class="button__close opacity-80" data-color="white"></div>
    </div>

    <div name="area" class="oScreen__content">
        <div class="pos-centered { w100p : app.device.isPhone }">
            <div class="container">
                <div class="row">
                    <div name="wrapper" class="col-xs-24 col-sm-14 col-md-12 col-lg-10 centered xs-pb-l">
                        <div name="icon" class="mb30 xs-mb-m transition-m transition-fn-cubic345 { trY-xl : success }">
                            <icon-feedback color="white" size="xl2"></icon-feedback>
                        </div>
                        <div class="anim anim-bt-ease { animated : !success } xs-plr-m">
                            <div class="mb-s fontSize-22">Укажите адрес получения резюме</div>
                            <input onKeydown={ onEnter } name="input" class="pointer-for-input input input-{ app.device.isPhone ? 'l' : 'xl' } input-white input-rounded mb-m text-center" placeholder="Введите e-mail" autocomplete="off">
                            <div class="row mb-l text-left-xs xs-pl-l xs-mb-m xs-pb-xxs">
                                <div class="col-xs-24 col-sm-12 xs-mb-s">
                                    <ui-checkbox title="Ссылка на резюме" color="white" size="xl" value={ attach.link }></ui-checkbox>
                                </div>
                                <div class="col-xs-24 col-sm-12">
                                    <ui-checkbox title="Прикрепить PDF" color="white" size="xl" value={ attach.pdf }></ui-checkbox>
                                </div>
                            </div>
                            <div onClick={ onSuccess } onUpdate="none" class="btn btn-xl2 c-blue btn-white-hover-success { btn-loading : loading }">Отправить</div>
                        </div>
                        <div class="anim anim-bt-ease fontSize-34 pointerEvents-none { animated : success }">
                            <div class="trY--xl { app.device.isPhone ? 'mt--xl' : 'mt--l' }">Резюме отправлено</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>

    var $ = this,
    $scope = $$($.root);

    $.active = false;
    $.attach = {
        link: true,
        pdf: false
    };
    $.input = $$($.input);

    $.show = function(id){
        if ($.active) return;

        $.active = true;

        $.root.style.display = "block";

        $afterlag.run(function(){
            $.update({
                id: id
            })
            if (!app.device.isMobile){
                _.onEndTransition($.area, function(){
                    $.input.focus();
                });
            }
        });
        document.removeEventListener('click', $.handleClickOutside)
    };

    $.onEnter = function(e){
        e.preventUpdate = true;
        if (e.which === KEY.ENTER){
            $.onSuccess();
        }
        return true;
    };

    $.onSuccess = function(){
        if (!$.id) return;

        if (_.isEmail($.input.val())){
            $.update({
                loading: true
            })
            app.request('addResumeSendmail', {
                id: $.id
            })
            .then(function(){
                $.update({
                    success: true,
                    loading: false
                })
                _.onEndTransition($.icon, function(){
                    $afterlag.xl(function(){
                        $.hide();
                    });
                });
            });
        }
        else {
            $Pointer.show({
                activeZone: true,
                scope: $scope,
                target: ".pointer-for-input",
                position: "up",
                color: "blue",
                text: "Укажите корректный email для отправления",
                padding: 18
            })
        }
    };

    $.hide = function(){
        if (!$.active) return;

        $.update({
            active: false
        })
        $afterlag.run(function(){
            _.onEndTransition($.area, function(){
                if ($.success){
                    $.update({
                        success: false
                    })
                }
                $.root.style.display = "none";
            });
        });
    };

    $.handleClickOutside = function(e){
        if (!$.wrapper.contains(e.target)) $.hide();
    };

    $.on("updated", function(){
        if ($.active){
            setTimeout(function(){
                document.addEventListener('click', $.handleClickOutside);
            }, 0);
        }
        else {
            document.removeEventListener('click', $.handleClickOutside)
        }
    });

</script>

</resume-sendmail>
