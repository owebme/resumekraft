<resume-sendmail class="oScreen zIndex-3 c-white { showAnim-group1 : active }" data-color="blue" data-open={ active }>

    <div onClick={ hide } onUpdate="none" class="anim-group1 anim-rl" data-duration="l" delay-show="m">
        <div class="button__close opacity-70" data-color="white"></div>
    </div>

    <div class="pos-centered { w100p : app.device.isPhone }">
        <div name="area" class="container anim-group1 anim-bt-ease" duration-show="m" duration-hide={ success ? 'l' : 'm' } delay-show="xs">
            <div class="row">
                <div name="wrapper" class="col-xs-24 col-sm-14 col-md-12 col-lg-10 centered xs-pb-l">
                    <div name="icon" class="mb30 xs-mb-m transition-l transition-fn-cubic345 { trY-xl : success }">
                        <icon-feedback color="white" size="xl2"></icon-feedback>
                    </div>
                    <div class="anim anim-group2 anim-bt-ease { animated : !success } xs-plr-m">
                        <div class="mb-s fontSize-22">Укажите адрес получения резюме</div>
                        <input onKeydown={ onEnter } onUpdate="none" name="input" class="pointer-for-input input input-{ app.device.isPhone ? 'l' : 'xl' } input-white input-rounded mb-m text-center" placeholder="Введите e-mail" autocomplete="off">
                        <div class="row mb-l text-left-xs xs-pl-l xs-mb-m xs-pb-xxs">
                            <div class="col-xs-24 col-sm-12 xs-mb-s">
                                <ui-checkbox title="Ссылка на резюме" color="white" size="xl" value={ attach.link }></ui-checkbox>
                            </div>
                            <div class="col-xs-24 col-sm-12">
                                <ui-checkbox title="Прикрепить PDF" color="white" size="xl" value={ attach.pdf }></ui-checkbox>
                            </div>
                        </div>
                        <div onClick={ onSuccess } onUpdate="none" class="btn btn-xxl btn-success { btn-loading : loading }">Отправить</div>
                    </div>
                    <div class="anim anim-group2 anim-bt-ease fontSize-34 pointerEvents-none { animated : success }">
                        <div class="trY--xl { mt--xl : app.device.isPhone }">Резюме отправлено</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>

    var $ = this,
    $scope = $$($.root);

    $.active = false;
    $.attach = {
        link: true,
        pdf: false
    };
    $.input = $$($.input);

    $.show = function(id){
        $.update({
            id: id,
            active: true
        })
        if (!app.device.isMobile){
            _.onEndTransition($.area, function(){
                $.input.focus();
            });
        }
    };

    $.onEnter = function(e){
        if (e.which === KEY.ENTER){
            $.onSuccess();
        }
        return true;
    };

    $.onSuccess = function(){
        if (!$.id) return;

        if (_.isEmail($.input.val())){
            $.update({
                loading: true
            })
            app.request('addResumeSendmail', {
                id: $.id
            })
            .then(function(){
                $.update({
                    success: true,
                    loading: false
                })
                _.onEndTransition($.icon, function(){
                    $afterlag.xl(function(){
                        $.hide();
                    });
                });
            });
        }
        else {
            $Pointer.show({
                activeZone: true,
                scope: $scope,
                target: ".pointer-for-input",
                position: "up",
                color: "blue",
                text: "Укажите корректный email для отправления",
                padding: 18
            })
        }
    };

    $.hide = function(){
        $.update({
            active: false
        })
        if ($.success){
            _.onEndTransition($.area, function(){
                $.update({
                    success: false
                })
            });
        }
    };

    $.handleClickOutside = function(e){
        if (!$.wrapper.contains(e.target)) $.hide();
    };

    $.on("updated", function(){
        if ($.active){
            document.addEventListener('click', $.handleClickOutside);
        }
        else {
            document.removeEventListener('click', $.handleClickOutside)
        }
    });

</script>

</resume-sendmail>
