<resume-edit-finish class="oScreen screen-finish c-white zIndex-10 { showAnim : animate }" data-color="blue" data-open={ active }>

    <div class="pos-centered zIndex-2">
        <h1 class="mb-l anim anim-bt" delay-show="s" data-duration={ m : app.device.isPhone }>Закончить редактирование?</h1>
        <div class="inline">
            <div class="display-inlineBlock anim anim-scale xsm-mb-m" delay-show="m" data-duration={ m : app.device.isPhone }>
                <button onClick={ hide } class="btn btn-xxl btn-success mlr-s">Еще, нет</button>
            </div>
            <div class="display-inlineBlock anim anim-scale" delay-show="l" data-duration={ m : app.device.isPhone }>
                <button onClick={ success } class="btn btn-xxl c-blue btn-white-hover mlr-s">Закончить</button>
            </div>
        </div>
    </div>

    <div class="pos-centered-h t90 nowrap zIndex-1">
        <p class="fontSize-24 letterSpacing-0 anim anim-scale" delay-show="xl" data-duration={ m : app.device.isPhone }>Ваше резюме <span class="hidden-xs">уже</span> сохранено.</p>
    </div>

    <div class="pos-centered-v l100 zIndex-1">
        <div class="anim anim-rl" data-duration={ m : app.device.isPhone }>
            <div name="circuful" class="circuful"></div>
        </div>
    </div>

    <div class="screen-finish-icon anim anim-scale" delay-show="s" data-duration={ m : app.device.isPhone }></div>

<script>

    var $ = this;

    $.active = false;
    $.animate = false;
    $.circuful = $$($["circuful"]);

    $.show = function(){
        if (app.device.isPhone){
            $.update({
                active: true
            })
            _.onEndTransition($.root, function(){
                $.update({
                    animate: true
                })
                $.chartRadial();
            });
        }
        else {
            $.update({
                active: true,
                animate: true
            })
            $.chartRadial();
        }
    };

    $.chartRadial = function(){
        $.circuful.empty().circliful({
            animation: 1,
            animationStep: 6,
            foregroundBorderWidth: app.device.isMobile ? 9.5 : 9,
            backgroundBorderWidth: app.device.isMobile ? 4 : 4,
            percentageTextSize: 28,
            percent: $.parent.sections.percentage ? $.parent.sections.percentage.p : 100,
            backgroundColor: 'rgba(255,255,255,.15)',
            foregroundColor: '#fff',
            fontColor: '#fff'
        });
    };

    $.hide = function(){
        $.update({
            active: false,
            animate: false
        })
    };

    $.success = function(){
        $resume.set(Store.get('resume'));
        $resume.select("update").set(moment().format());
        $store.data.select({"_id": $resume.get("_id")}).set($resume.get());

        app.request("setResume", {
            data: $resume.get()
        }, {
            loader: false
        });

        $.hide();

        _.onEndTransition($.root, function(){
            $Sections.resume.edit.hide();
            $Sections.resume.list.update();
        });

        app.metrika.set("resume.create.settings.success", true);
    };

</script>

</resume-edit-finish>
