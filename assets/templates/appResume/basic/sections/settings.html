<resume-settings class="oScreen screen-settings c-white zIndex-10 { showAnim : active }" data-color="blue" data-open={ active }>

    <div onClick={ hide } onUpdate="none" class="button__close" data-color="white"></div>

    <div class="{ pos-centered : !app.device.isPhone }">
        <div class="container content anim anim-bt-ease pt30" data-content="settings" duration-show="m" duration-hide="s">
            <div class="row text-center mb25">
                <div class="col-xs-24 col-sm-12 transition-s { opacity-50 : !config.get('public') }">
                    <div class="pos-rel aspectRatio-169 mtb-s mlr-m">
                        <div class="pos-abs-full borderRadius-xl borderWidth-1 borderStyle-solid borderColor-white opacity-50"></div>
                        <div class="pos-centered mt--l">
                            <ui-switcher update="public" commit={ true } cursor={ config.select() }></ui-switcher>
                        </div>
                        <div class="pos-centered-h b-30 w100p">
                            <div class="fontSize-28 mb-xs">Опубликовать резюме</div>
                            <div class="fontSize-20 plr-m { display-none : showLink }">Получить <span onClick={ open.link } class="link-underline link-lime">прямую ссылку</span> на резюме</div>
                            <div class="plr-m mb--xs { display-none : !showLink }">
                                <input class="input input-m input-white { opacity-50 : !$resume.get('public') }" value="http://resumekraft.ru/resume/4a170ef2fc400bd89c618b2de1e3674e18757d32">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-24 col-sm-12 transition-s { opacity-50 : !config.get('logotype') }">
                    <div class="pos-rel aspectRatio-169 mtb-s mlr-m">
                        <div class="pos-abs-full borderRadius-xl borderWidth-1 borderStyle-solid borderColor-white opacity-50"></div>
                        <div class="pos-centered mt--l">
                            <ui-switcher update="logotype" i="logotype" commit={ change } cursor={ config.select() }></ui-switcher>
                        </div>
                        <div class="pos-centered-h b-30 w100p">
                            <div class="fontSize-28 mb-xs">Оставлять логотип</div>
                            <div class="fontSize-20 plr-m">Логотип на PDF файле</div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-24 col-sm-12 transition-s { opacity-50 : !config.get('stat') }">
                    <div class="pos-rel aspectRatio-169 mtb-s mlr-m">
                        <div class="pos-abs-full borderRadius-xl borderWidth-1 borderStyle-solid borderColor-white opacity-50"></div>
                        <div class="pos-centered mt--l">
                            <ui-switcher update="stat" i="stat" commit={ change } cursor={ config.select() }></ui-switcher>
                        </div>
                        <div class="pos-centered-h b-30 w100p">
                            <div class="fontSize-28 mb-xs">Собирать статистику</div>
                            <div class="fontSize-20 plr-m">Просмотры резюме работодателями</div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-24 col-sm-12 transition-s { opacity-50 : !config.get('lang') }">
                    <div class="pos-rel aspectRatio-169 mtb-s mlr-m">
                        <div class="pos-abs-full borderRadius-xl borderWidth-1 borderStyle-solid borderColor-white opacity-50"></div>
                        <div class="pos-centered mt--l">
                            <ui-switcher update="lang" i="lang" commit={ change } cursor={ config.select() }></ui-switcher>
                        </div>
                        <div class="pos-centered-h b-30 w100p">
                            <div class="fontSize-28 mb-xs">Резюме на англ. языке</div>
                            <div class="fontSize-20 plr-m">Изменить язык</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row text-center">
                <div class="col-xs-24">
                    <button onClick={ onCancel } class="btn btn-xxl c-blue btn-white-hover mlr-xs">Отменить</button>
                    <button onClick={ onSave } class="btn btn-xxl c-blue btn-white mlr-xs">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

<script>

    var $ = this;

    $.active = false;

    $.config = new Baobab({
        public: $store.resume.get("public"),
        logotype: $store.resume.get("config", "pdf", "logotype"),
        stat: $store.resume.get("config", "stat"),
        lang: $store.resume.get("lang") == "en" ? true : false
    });

    $.showLink = false;

    $.show = function(){
        $.store = $.config.clone();

        $.update({
            active: true
        })
    };

    $.open = {
        link: function(){
            $.showLink = true;
        }
    };

    $.change = function(value, i){
        var text = "";

        if ($account.get('plan') == "premium"){
            $.update();
            return;
        }

        if (i == "logotype") text = "Чтобы убрать логотип вам нужен другой аккаунт";
        else if (i == "stat") text = "Чтобы собирать статистику вам нужен другой аккаунт";
        else if (i == "lang") text = "Чтобы создать резюме на другом языке вам нужен другой аккаунт";

        if (!value && i == "logotype" || i != "logotype" && value){
            $Alert.show({
                title: "Перейти на Premium?",
                subtitle: text,
                success: {
                    title: "Перейти",
                    callback: function(){
                        $Sections.plan.show();
                    }
                },
                cancel: {
                    callback: function(){
                        $.config.select(i).set(i == "logotype" ? true : false);
                        $.update();
                    }
                }
            });
        }
        $.update();
    };

    $.onCancel = function(){
        $.hide(function(){
            $.config.set($.store);
            $.update();
        });
    };

    $.onSave = function(){
        $.hide(function(){
            $store.resume.select("public")
            .set($.config.get("public"));

            if ($account.get('plan') == "premium"){
                $store.resume.select("config", "pdf", "logotype")
                .set($.config.get("logotype"));

                $store.resume.select("config", "stat")
                .set($.config.get("stat"));

                if ($.store.lang !== $.config.get("lang")){
                    $store.resume.select("lang")
                    .set($.config.get("lang") ? "en" : "ru");
                }
            }
        });
    };

    $.hide = function(callback){
        $.update({
            active: false
        })
        if (_.isFunction(callback)){
            _.onEndTransition($.root, function(){
                callback();
            });
        }
    };

</script>

</resume-settings>
