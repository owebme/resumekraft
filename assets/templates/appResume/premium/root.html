<root-main class="appResume section" data-color="{ $State.get('color') }" data-font="{ $State.get('font') }" data-mode={ $State.get('mode')} data-app="premium">

    <section-nav if={ !app.device.isMobile }></section-nav>

    <section-info if={ $State.get('mode') !== "editing" }></section-info>
    <section-sendmail if={ $State.get('mode') !== "editing" }></section-sendmail>
    <salary-graph-opener if={ $State.get('mode') !== "editing" && $resume.salary.graph.active }></salary-graph-opener>
    <salary-graph></salary-graph>

    <section-notify if={ $State.get('mode') === "editing" }></section-notify>

    <sections-control if={ $State.get('mode') === "editing" }>

        <section-menu></section-menu>
        <menu-opener></menu-opener>

        <control-fonts></control-fonts>
        <control-colors></control-colors>
        <control-sections></control-sections>
        <section-editable></section-editable>

    </sections-control>

    <resume-template1></resume-template1>

    <div class="section__overlay zIndex-7"></div>

<script>

    $root = this;

    $$ = window.jQuery || window.Zepto;

    $resume = $store.resume.get();

    var mode = app.demo ? app.demo : "editing";

    $State = new Baobab({
        mode: mode,
        public: true,
        lang: "ru",
        color: "#0084ff",
        font: "futura",
        photo: {
            minWidth: 440,
            maxHeight: 620,
            noise: false
        }
    },
    { autoCommit: true });

    this.on("before-mount", function(){

        $Menu = $root.tags["section-menu"];
        $Nav = $root.tags["section-nav"];
        $Info = $root.tags["section-info"];
        $Sendmail = $root.tags["section-sendmail"];
        $Editable = $root.tags["section-editable"];
        $Helper = $Editable.tags["ui-help"];
        $Notify = $root.tags["section-notify"];

        $Control = {
            fonts: $root.tags["control-fonts"],
            colors: $root.tags["control-colors"],
            sections: $root.tags["control-sections"]
        }
        $Salary = {
            opener: $root.tags["salary-graph-opener"],
            graph: $root.tags["salary-graph"]
        }

        $Resume = $root.tags["resume-template1"];
    });

    this.one("ready", function(){
        app.$dom.body.removeClass("appLoading");

        if (app.demo){
            if (window.parent && window.parent){
                window.parent.postMessage('ready', '*');
            }
            app.$dom.window.on("message", function(e){
                var data = e.originalEvent.data;
                if (data){
                    if (data.color){
                        $State.select('color').set(data.color);
                    }
                }
            });
            $store.resume.select('photo')
            .set("/preview/images/photo/photo_" + app.device.is + ".jpg");
            $Resume.sections.photo.update();
        }
    });

    this.on("mode", function(mode, value){
        if (mode == "hidden"){
            if (app.device.isPhone){
                $Resume.root.setAttribute("data-hidden", value);
            }
            else {
                $root.root.setAttribute("data-overlay", value);
            }
        }
        else if (mode == "menu"){
            $root.root.setAttribute("data-menu", value);
        }
    });

    if (app.config.changeStyles){
        app.plugins.styles.init({
            elem: "#styles",
            default: "normal",
            screens: [
                {
                    title: "small",
                    maxWidth: 360,
                    path: "/assets/css/premium.smallScreen.css?" + _.newId()
                },
                {
                    title: "phone",
                    minWidth: 360,
                    maxWidth: 767,
                    reload: true
                },
                {
                    title: "normal",
                    minWidth: 1025,
                    maxWidth: 1400,
                    path: "/assets/css/premium.css?" + _.newId(),
                    reload: true
                },
                {
                    title: "large",
                    minWidth: 1400,
                    path: "/assets/css/premium.largeScreen.css?" + _.newId()
                }
            ]
        });
    }

</script>

</root-main>
