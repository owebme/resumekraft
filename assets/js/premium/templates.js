riot.tag2("root-main-view",'<section-nav if="{!app.device.isMobile}"></section-nav> <section-info></section-info> <section-sendmail></section-sendmail> <salary-graph-opener></salary-graph-opener> <salary-graph></salary-graph> <sections-control if="{$State.get(\'mode\') === ⁗editing⁗}"> <control-colors></control-colors> </sections-control> <resume-template1></resume-template1> <div class="section__overlay zIndex-7"></div>',"","class=\"appResume section\" data-color=\"{$State.get('color')}\" data-font=\"{$State.get('font')}\" data-mode=\"{$State.get('mode')}\" data-coverletter=\"{$State.get('mode') !== ⁗editing⁗ && $store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗coverletter⁗}).active}\" data-animation=\"{!app.device.isPhone && $State.get('mode') === 'view' && $State.get('animate')}\" data-app=\"premium\"",function(e){$root=this,$$=window.jQuery||window.Zepto,$resume=app.demo?$store.resume.prepare.demo():$store.resume.get(),this.init=function(){$i18n.lang($resume.lang),moment.locale($resume.lang);var e="true"==this.opts.editing?"editing":"view",t=$store.resume.select("config").deepClone();t.mode=e,t.public=$store.resume.get("public"),t.lang=$store.resume.get("lang"),$State=new Baobab(t,{autoCommit:!0})},this.init(),this.on("before-mount",function(){$Menu=$root.tags["section-menu"],$Nav=$root.tags["section-nav"],$Info=$root.tags["section-info"],$Sendmail=$root.tags["section-sendmail"],$Control={colors:$root.tags["control-colors"]},$Salary={opener:$root.tags["salary-graph-opener"],graph:$root.tags["salary-graph"]},$Resume=$root.tags["resume-template1"]}),this.one("ready",function(){if(!app.device.isMobile&&$State.get("animate")===!0){var e=new app.plugins.scroll.ParallaxController({items:[{selector:app.device.isSafari?"ux-photo":".photo",from:100,to:-150,off:0}]});e.start()}app.$dom.body.removeClass("appLoading").attr("id","ready"),app.device.isPhone||$State.get("animate")!==!0||$afterlag.run(function(){var e=new app.plugins.scroll.AnimationController({container:$root.root}),t=new app.plugins.scroll.animate({container:$root.root,onlyItems:!0,items:[{elem:".skills-progress",callback:function(e,t){e.addClass("animated")}},{elem:".choose__contact",callback:function(e,t){e.addClass("animated")}}]});e.start(),t.start()}),app.demo&&(window.parent&&window.parent&&window.parent.postMessage("ready","*"),app.$dom.window.on("message",function(e){var t=e.originalEvent.data;t&&(t.color&&$State.get("color")!=t.color&&$State.select("color").set(t.color),t.resume&&($Resume.unmount(!0),$resume=$store.resume.prepare.premium(t.resume,"demo"),$root.init(),$Resume=riot.mount("resume-template1")[0],$Resume.one("updated",function(){$Salary.opener.update(),$Salary.graph.update(),window.parent.postMessage({resume:$store.resume.get()},"*")})))}),$store.resume.select("commons","photo").set("/preview/images/photo/photo_"+app.device.is+".jpg"),$Resume.sections.photo.update()),$root.ready=!0}),this.on("mode",function(e,t){"hidden"==e?app.device.isPhone?$Resume.root.setAttribute("data-hidden",t):$root.root.setAttribute("data-overlay",t):"menu"==e?$root.root.setAttribute("data-menu",t):"coverletter"==e&&$root.root.setAttribute("data-coverletter",t)}),app.config.changeStyles&&app.plugins.styles.init({elem:"#styles",default:"normal",screens:[{title:"small",maxWidth:360,path:"/assets/css/premium.smallScreen.css?"+_.newId()},{title:"phone",minWidth:360,maxWidth:767,reload:!0},{title:"normal",minWidth:1025,maxWidth:1400,path:"/assets/css/premium.css?"+_.newId(),reload:!0},{title:"large",minWidth:1400,path:"/assets/css/premium.largeScreen.css?"+_.newId()}]})}),riot.tag2("root-main",'<section-nav if="{!app.device.isMobile}"></section-nav> <section-info if="{$State.get(\'mode\') !== ⁗editing⁗}"></section-info> <section-sendmail if="{$State.get(\'mode\') !== ⁗editing⁗}"></section-sendmail> <salary-graph-opener if="{$State.get(\'mode\') !== ⁗editing⁗ && $resume.salary.graph.active}"></salary-graph-opener> <salary-graph></salary-graph> <sections-control if="{$State.get(\'mode\') === ⁗editing⁗}"> <section-menu></section-menu> <menu-opener></menu-opener> <control-fonts></control-fonts> <control-colors></control-colors> <control-sections></control-sections> <control-public></control-public> <section-editable></section-editable> <section-percentage if="{!app.device.isMobile}"></section-percentage> <text-edit></text-edit> <resume-button-save section="{$Sections.finish}"></resume-button-save> </sections-control> <resume-template1></resume-template1> <div class="section__overlay zIndex-7"></div> <resume-edit-finish percentage="{$Sections.percentage}"></resume-edit-finish> <section-loader></section-loader> <section-notify if="{$State.get(\'mode\') === ⁗editing⁗}"></section-notify> <section-tutorial if="{$State.get(\'mode\') === ⁗editing⁗}"></section-tutorial>',"",'class="appResume section" data-color="{$State.get(\'color\')}" data-font="{$State.get(\'font\')}" data-mode="{$State.get(\'mode\')}" data-coverletter="{$State.get(\'mode\') !== ⁗editing⁗ && $store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗coverletter⁗}).active}" data-app="premium"',function(e){$root=this,$$=window.jQuery||window.Zepto;var t=Store.get("resume"),s=!1;!app.demo&&t&&t._id==$store.resume.get("_id")&&t.plan==$store.resume.get("plan")&&moment(t.update).diff(moment($store.resume.get("update")))>0&&($store.resume.set(t),s=!0),$resume=app.demo?$store.resume.prepare.demo():$store.resume.prepare.premium($store.resume.get(),!0),$i18n.lang($resume.lang),moment.locale($resume.lang);var o="true"==this.opts.editing?"editing":"view",i=$store.resume.select("config").deepClone();i.mode=o,$State=new Baobab(i,{autoCommit:!0}),$Sections={percentage:$root.tags["section-percentage"],textEdit:$root.tags["text-edit"],finish:$root.tags["resume-edit-finish"]},this.on("before-mount",function(){$Menu=$root.tags["section-menu"],$Nav=$root.tags["section-nav"],$Info=$root.tags["section-info"],$Sendmail=$root.tags["section-sendmail"],$Editable=$root.tags["section-editable"],$Helper=$Editable.tags["ui-help"],$Loader=$root.tags["section-loader"],$Notify=$root.tags["section-notify"],$Tutorial=$root.tags["section-tutorial"],$Control={fonts:$root.tags["control-fonts"],colors:$root.tags["control-colors"],sections:$root.tags["control-sections"],public:$root.tags["control-public"]},$Salary={opener:$root.tags["salary-graph-opener"],graph:$root.tags["salary-graph"]},$Resume=$root.tags["resume-template1"]}),this.one("ready",function(){app.$dom.body.removeClass("appLoading").attr("id","ready"),app.demo?(window.parent&&window.parent&&window.parent.postMessage("ready","*"),app.$dom.window.on("message",function(e){var t=e.originalEvent.data;t&&t.color&&$State.select("color").set(t.color)}),$store.resume.select("commons","photo").set("/preview/images/photo/photo_"+app.device.is+".jpg"),$Resume.sections.photo.update()):(s&&$Notify.show({color:"dark",text:"Резюме восстановлено из резервной копии"}),$root.autoSave()),app.device.isPhone&&new app.plugins.scroll.refreshFix($root.root),$root.ready=!0}),this.on("mode",function(e,t){"hidden"==e?app.device.isPhone?$Resume.root.setAttribute("data-hidden",t):$root.root.setAttribute("data-overlay",t):"menu"==e?$root.root.setAttribute("data-menu",t):"coverletter"==e&&$root.root.setAttribute("data-coverletter",t)}),this.autoSave=function(){$root.autoSaveInterval=setInterval(function(){$store.resume.select("update").set(moment().format()),Store.set("resume",$store.resume.get())},1e3*app.config.resume.premium.autoSave.interval)},app.config.changeStyles&&app.plugins.styles.init({elem:"#styles",default:"normal",screens:[{title:"small",maxWidth:360,path:"/assets/css/premium.smallScreen.css?"+_.newId()},{title:"phone",minWidth:360,maxWidth:767,reload:!0},{title:"normal",minWidth:1025,maxWidth:1680,path:"/assets/css/premium.css?"+_.newId(),reload:!0},{title:"large",minWidth:1680,path:"/assets/css/premium.largeScreen.css?"+_.newId()}]})}),riot.tag2("resume-template1",'<div if="{!app.device.isPhone}" class="hidden-xs hidden-sm overlay col-sm-6"></div> <div if="{!app.device.isPhone}" class="hidden-xs hidden-sm main-line col-sm-6"></div> <div if="{!app.device.isPhone}" class="hidden-xs hidden-sm main-line-bg col-sm-6"></div> <section class="screen screen--active" data-section="coverletter" data-color="{$store.resume.take.coverletter.color()}" if="{$State.get(\'mode\') !== ⁗editing⁗ && $store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗coverletter⁗}).active}"> <div class="screen__content"> <ux-coverletter></ux-coverletter> </div> </section> <section if="{app.device.isPhone}" class="screen screen--first {$State.get(\'mode\') !== \'editing\' && $store.resume.select(\'sections\').get({\'name\': \'coverletter\'}).active ? null : \'screen--active\'}" data-section="cover"> <div class="screen__content"> <ux-photo phone="true"></ux-photo> <div if="{$store.resume.get(\'post\')}" class="screen__post"> <div class="screen__post__text"> {$store.resume.get(\'post\')} </div> </div> <div if="{$store.resume.get(\'commons\', \'contacts\', \'city\')}" class="screen__location"> <span class="display-inlineBlock text-truncate w90p">{$store.resume.get(\'commons\', \'contacts\', \'city\', \'name\')}, <span class="text-lowercase">{$store.resume.take.relocation()}</span></span> <div class="screen__progress" riot-style="width:{$store.resume.get(\'percent\')}%"> <div class="screen__progress__line"></div> </div> </div> </div> </section> <section class="screen {\'screen--first\' : !app.device.isPhone}" data-section="commons"> <div class="screen__content"> <div class="row"> <div if="{!app.device.isPhone}" class="col-xs-24 col-md-11 screen1-col-left"> <ux-photo title="Ваша фотография"></ux-photo> </div> <div class="col-xs-24 col-md-13 screen1-col-right"> <ux-name classname="h1 name" size="l" title="Ваше имя и фамилия"></ux-name> <ux-text autosuggest="getSuggestPositions" classname="h3 post" update="post" cursor="{$store.resume.select()}" title="Должность" type="input"></ux-text> <ux-salary if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗salary⁗}).active}" classname="salary" title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗salary⁗}).title}"></ux-salary> <ux-tags if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗tags⁗}).active}" classname="tag-list" title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗tags⁗}).title}"></ux-tags> <ux-text if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗appeal⁗}).active}" classname="larger mb-l" center="true" size="l" update="appeal" cursor="{$store.resume.select()}" activity="true" title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗appeal⁗}).title}" type="textarea"></ux-text> <ux-text name="ux-about" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗about⁗}).active && !$store.resume.isLargeAboutMe()}" classname="p mb-l" center="true" update="about" cursor="{$store.resume.select()}" activity="true" title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗about⁗}).title}" type="textarea"></ux-text> <ux-social if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗social⁗}).active}" classname="social" size="l" title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗social⁗}).title}"></ux-social> </div> <ux-text-large name="ux-about-large" class="display-block col-xs-24 col-md-18 col-md-offset-6"></ux-text-large> </div> </div> </section> <section class="screen" data-section="works" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗works⁗}).active}"> <div class="screen__content"> <ux-works title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗works⁗}).title}" center="true" size="xl"></ux-works> </div> </section> <section class="screen" data-section="skills" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗skills⁗}).active}"> <div class="bg-section hidden-xs {bg-show : $store.resume.select(\'sections\').get({\'name\': \'works\'}).active}"></div> <div class="screen__content"> <div class="row"> <div class="col-xs-24 col-md-18 col-md-offset-6"> <div class="screen__inner"> <ux-skills title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗skills⁗}).title}" center="true" size="xl"></ux-skills> </div> </div> </div> </div> </section> <section class="screen" data-section="education" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗education⁗}).active}"> <div class="screen__content"> <div class="row"> <div class="col-xs-24 col-md-18 col-md-offset-6"> <div class="screen__inner"> <ux-education title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗education⁗}).title}" center="true" size="xl"></ux-education> </div> </div> </div> </div> </section> <section class="screen" data-section="courses" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗courses⁗}).active}"> <div class="screen__content"> <div class="row"> <div class="col-xs-24 col-md-18 col-md-offset-6"> <div class="screen__inner"> <ux-courses title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗courses⁗}).title}" center="true" size="xl"></ux-courses> </div> </div> </div> </div> </section> <section class="screen" data-section="languages" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗languages⁗}).active}"> <div class="bg-section bg-snow hidden-xs"></div> <div class="screen__content"> <div class="row"> <div class="col-xs-24 col-md-18 col-md-offset-6"> <div class="screen__inner"> <ux-languages title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗languages⁗}).title}" center="true" size="xl"></ux-languages> </div> </div> </div> </div> </section> <section class="screen" data-section="jobs" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗jobs⁗}).active}"> <div class="screen__content"> <ux-jobs title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗jobs⁗}).title}" center="true" size="xl"></ux-jobs> </div> </section> <section class="screen" data-section="hobby" if="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗hobby⁗}).active}"> <div class="screen__content"> <div class="row"> <div class="col-xs-24 col-md-18 col-md-offset-6"> <div class="screen__inner"> <ux-hobby title="{$store.resume.select(⁗sections⁗).get({⁗name⁗: ⁗hobby⁗}).title}" center="true" size="xl"></ux-hobby> </div> </div> </div> </div> </section> <section class="screen" data-section="contacts" if="{app.device.isPhone}"> <div class="screen__content"> <h3 class="title">{$i18n(⁗resume.premium.template.Contacts info⁗)}</h3> <ux-contacts-content></ux-contacts-content> </div> </section> <section class="screen" data-section="businessTrip" if="{app.device.isPhone}"> <div class="screen__content"> <h3 class="title">{$i18n(⁗resume.premium.template.Business trip, relocation⁗)}</h3> <ux-contacts-more></ux-contacts-more> </div> </section> <section class="screen" data-section="feedback" if="{app.device.isPhone}"> <div class="screen__content"> <h3 class="title">{$i18n(⁗resume.premium.template.Feedback⁗)}</h3> <ux-feedback></ux-feedback> </div> </section> <section class="screen" data-section="contacts" if="{!app.device.isPhone}"> <div class="screen__content"> <ux-contacts></ux-contacts> </div> </section> <section class="screen" data-section="likes" if="{app.device.isPhone && $State.get(\'mode\') !== ⁗editing⁗ && $store.resume.get(⁗config⁗, ⁗likes⁗, ⁗active⁗) && !app.isLiked}"> <div class="screen__content"> <ux-likes></ux-likes> </div> </section> <popup-likes if="{!app.device.isPhone && $State.get(\'mode\') !== ⁗editing⁗ && $store.resume.get(⁗config⁗, ⁗likes⁗, ⁗active⁗) && !app.isLiked}"></popup-likes>',"",'class="screens screens-phone container resume template1"',function(e){var t=this;t.el=$$(this.root),$screens=null,t.screenItems=null,t.screenColor=null,t.controlColor="primary",t.on("before-mount",function(){t.sections={photo:_.filter(t.tags["ux-photo"],function(e){return app.device.isPhone?e.opts&&e.opts.phone:e.opts&&!e.opts.phone})[0],salary:t.tags["ux-salary"],social:t.tags["ux-social"],contacts:t.tags["ux-contacts"],contactsContent:app.device.isPhone?t.tags["ux-contacts-content"]:t.tags["ux-contacts"].tags["ux-contacts-content"],feedback:app.device.isPhone?t.tags["ux-feedback"]:t.tags["ux-contacts"].tags["ux-feedback"]},t.sections.social.on("updated",function(){t.sections.contactsContent&&t.sections.contactsContent.update()})}),t.on("mount",function(){"editing"!==$State.get("mode")&&(t.notTouch=["name","text","contacts","feedback","contacts-content","contacts-more","likes"],_.each(this.tags,function(e){if(e.root&&e.root.tagName&&e.root.tagName.toLowerCase().match(/^ux-/)){var s=e.root.tagName.toLowerCase().match(/^ux-(.+)/)[1];t.notTouch.indexOf(s)===-1&&($store.resume.get(s)?$$(e.root).children().unwrap():$$(e.root).remove())}}),_.each($store.resume.get("sections"),function(e){e.screen&&e.control&&t.notTouch.indexOf(e.name)===-1&&!$store.resume.get(e.name)&&$Resume.el.find(".screen[data-section="+e.name+"]").remove()}));var e=_.throttle(t.onScroll,50),s=_.debounce(t.render,300);if(app.device.isPhone?$afterlag.run(function(){if(t.screens=new app.plugins.screens($Resume.el,{dataAttr:"section",resizeRefresh:app.demo&&"editing"!==$State.get("mode")}),t.screens.init(),t.render(),t.initScroll(),function s(){t.raf=app.utils.raf(s),e(app.utils.getScroll(t.scroll))}(),$root.trigger("ready"),"editing"!==$State.get("mode")&&$store.resume.select("sections").get({name:"coverletter"}).active){var s=!0;$screens=$Resume.el.find(".screen"),$screens.on("show",function(){var e=this.getAttribute("data-section");"coverletter"!=e||s?"coverletter"!=e&&s&&(s=!1,$root.trigger("mode","coverletter",s)):(s=!0,$root.trigger("mode","coverletter",s))})}}):(t.render(),app.$dom.window.on("scroll",function(){_.raf(e)}),$afterlag.run(function(){$root.trigger("ready")})),app.$dom.window.on("resize",function(){s()}),"editing"===$State.get("mode")){var o=["social","works","skills","education","courses","languages","jobs","hobby"],i=["percent","config","update"];_.bbUpdate($store.resume,function(e,t,s){if($root.ready&&i.indexOf(e)===-1){if("public"==e)return void $Control.public.update();if("lang"==e)$i18n.lang($store.resume.get("lang")),moment.locale($store.resume.get("lang")),_.each($store.resume.placeholder,function(e,t){o.indexOf(t)!==-1&&$store.resume.get(t,"title")&&$store.resume.select(t,"title").set(e.title())}),$Resume.update(),app.device.isPhone&&$Resume.screens&&$afterlag.run(function(){$Resume.screens.refresh()});else if("sections"==e&&$Resume.screenItems){var n=!1;_.each(s.data.currentData.sections,function(e){if(e.screen&&(!e.screen||e.control)){var t=_.findWhere($Resume.screenItems,{section:e.name});t||(t={active:!1}),e.active!==t.active&&(n=!0)}}),n?($Resume.update(),app.device.isPhone&&($Resume.screens.refreshAll(),$Resume.initScroll())):app.device.isPhone&&$Resume.screens&&$afterlag.run(function(){$Resume.screens.refresh()}),$Control.sections.refresh()}else app.device.isPhone&&$Resume.screens&&$afterlag.run(function(){$Resume.screens.refresh()});$Resume.render()}}),_.bbUpdate($State,function(e,t,s){$root.ready&&("color"==e?($Control.colors.update(),$root.root.setAttribute("data-color",t),$Resume.sections.salary.graph.refresh(),$store.resume.select("config","color").set(t)):"font"==e?($Control.fonts.update(),$root.root.setAttribute("data-font",t),$store.resume.select("config","font").set(t),$Resume.render()):"photo"==e?($Resume.sections.photo.update(),$store.resume.select("config","photo",s.data.paths[0][1]).set(t)):"animate"==e&&$store.resume.select("config","animate",t))})}else app.demo&&_.bbUpdate($State,function(e,t,s){$root.ready&&"color"==e&&($Control.colors.update(),$root.root.setAttribute("data-color",t),$Resume.sections.salary.graph.refresh())})}),t.initScroll=function(){t.scroll=$Resume.screens.get("scroll")},t.render=function(){var e=[],s=$store.resume.get("lang");t.screenColor=[],setTimeout(function(){if(!app.device.isPhone||$Resume.screens){if(app.device.isPhone)var o=$Resume.screens.scope.data("marquee").screens;$Resume.el.find(".screen").each(function(i,n){var a=$$(this),r=this.getAttribute("data-section");if("coverletter"!=r){if("works"==r||"jobs"==r||"contacts"==r)if(app.device.isPhone){if("contacts"==r)return;t.screenColor.push({height:o[i].size-120,offset:o[i].offset+120})}else{if("contacts"==r)var c=a;else var c=a.find(".bg-section");t.screenColor.push({height:c.height(),offset:c.offset().top-80})}var l=null;"commons"==r?l="ru"==s?"Общее":"Main":$store.resume.placeholder[r]&&(l=$store.resume.placeholder[r].shortname[s]);var n=_.findWhere($store.resume.get("sections"),{name:r});e.push({title:l,section:r,step:i+1,offset:a.offset().top,active:!n||n.active})}}),t.screenItems=e,!app.device.isMobile&&$Nav&&$Nav.refresh()}},5)};var s=0,o=!1,i=!1,n=!app.demo&&!app.device.isPhone&&"true"!=$root.opts.editing&&$store.resume.get("config","likes","active")&&!app.isLiked;t.onScroll=function(e){var e=e&&e.y||app.$dom.document.scrollTop(),a=!1;if(_.each(t.screenColor,function(s){a||e>s.offset&&e<s.offset+s.height&&(a=!0,"white"!=t.controlColor&&$root.root.setAttribute("data-control-color","white"))}),a||"primary"==t.color||$root.root.setAttribute("data-control-color","primary"),app.demo&&!o&&"true"==$root.opts.editing||n&&!i){var r=$Resume.el&&$Resume.el[0]&&$Resume.el[0].scrollHeight;r&&r>0&&e+app.sizes.height+20>r&&s<e&&(app.demo&&!o&&"true"==$root.opts.editing?(o=!0,$Sections.finish.show()):n&&!i&&(i=!0,$Resume.tags["popup-likes"].show())),s=e}},t.on("before-unmount",function(){$screens&&$screens.off("show"),t.screens.destroy(),$store.resume.off(),$State.off(),_.caf(t.raf)})});